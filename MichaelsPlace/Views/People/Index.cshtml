@using MichaelsPlace.Extensions
@model MichaelsPlace.Controllers.Admin.PeopleIndexViewModel

@{
    ViewBag.Title = "User Index";
}

@using BootstrapSupport
@using MichaelsPlace.Controllers.Admin
@using MichaelsPlace.Models.Admin
@using RestSharp.Extensions

@using (var tabs = Bootstrap.Tabs().AddStyle("margin-bottom","10px").Begin())
{
    <li><h2 style="margin: 0 15px 0 0; text-transform: none;">People</h2></li>
    @tabs.Tab("All", Url.Action("Index", new { displayMode = PeopleIndexDisplayMode.All })).SetActive(Model.DisplayMode == PeopleIndexDisplayMode.All)
    @tabs.Tab("Staff", Url.Action("Index", new { displayMode = PeopleIndexDisplayMode.Staff })).SetActive(Model.DisplayMode == PeopleIndexDisplayMode.Staff)
    @tabs.Tab("Clients", Url.Action("Index", new { displayMode = PeopleIndexDisplayMode.Clients})).SetActive(Model.DisplayMode == PeopleIndexDisplayMode.Clients)
}

@using (var table = Bootstrap.AjaxDataTable(Url)
    .AddData("ajax-data", Json.Encode(new {Model.DisplayMode}))
    .Begin())
{
    <thead>
    <tr>
        <th data-property="@nameof(PersonModel.EmailAddress).ToCamelCase()"  data-priority="1">
            @Html.DisplayNameFor(model => model.People[0].EmailAddress)
        </th>
        <th data-property="@nameof(PersonModel.FirstName).ToCamelCase()">
            @Html.DisplayNameFor(model => model.People[0].FirstName)
        </th>
        <th data-property="@nameof(PersonModel.LastName).ToCamelCase()">
            @Html.DisplayNameFor(model => model.People[0].LastName)
        </th>
        <th class="col-md-1" id="item-buttons">Actions</th>
    </tr>
    </thead>
    <tbody>
    </tbody>
}

@Html.Partial("Templates/_IndexEditModal")
@Html.Partial("Templates/_IndexDetailsModal")
@*@Html.Partial("Templates/_IndexItemButtons")*@

<div id="ajax-modal"></div>

<script id="_IndexItemButtons" type="text/template" class="template">
    <div class="btn-group btn-group-sm">
        <a data-ajax="true" data-ajax-success="indexViewModel.modalLoaded" role="button" href="@Url.Action("Details")/{{id}}" class="btn btn-default" title="Details">
            <span class="glyphicon glyphicon-th-list"></span>
        </a>
        <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="More Actions">
            <span class="caret"></span>
            <span class="sr-only">Toggle Dropdown</span>
        </button>

        <ul class="dropdown-menu dropdown-menu-right">
            @Bootstrap.AjaxDropdownLinkButton("Edit", @Url.Action("Edit") + "/{{id}}")
            @Bootstrap.DropdownLink("Edit Security Settings").SetHref(@Url.Action("Edit", "User") + "/{{id}}").AddData("ajax", "true").AddData("ajax-success", "indexViewModel.modalLoaded")
            @Bootstrap.DropdownLink("Delete").SetHref(@Url.Action("Delete") + "/{{id}}").AddCss("delete-item").SetState(TextState.Danger)
        </ul>
</div>
</script>